---
// ProjectsCard UI component
// Composed from the generic Card container.

import Card from './Card.astro';
import Button from './Button.astro';
import { Icon } from 'astro-icon/components';
import { getIconName } from '../../icons/iconMap';

interface Props {
  image?: string;
  title: string;
  languages?: string[];
  contributors?: string[];
  description?: string;
  links?: string;
  demo?: string;
  index?: number;
  organisation?: any;
}

const {
  image,
  title,
  languages = [],
  contributors = [],
  description,
  links,
  demo,
  index = 0,
  organisation,
} = Astro.props;

const imageSrc =
  typeof image === 'object' && image?.src ? image.src : image;
const organisationSrc =
  typeof organisation === 'object' && organisation?.src ? organisation.src : organisation;

const languageIconKeyMap: Record<string, string> = {
  Astro: 'astro',
  Tailwind: 'tailwind',
  TailwindCSS: 'tailwind',
  TypeScript: 'typescript',
  Typescript: 'typescript',
  TS: 'typescript',
  Python: 'python',
  Vercel: 'vercel',
};

const getLanguageIconName = (lang: string): string | null => {
  const key = languageIconKeyMap[lang];
  return key ? getIconName(key as any) : null;
};
---

<div
  class="opacity-0 translate-y-3 project-card-animate"
  style={`animation-delay: ${index * 0.08}s`}
>
  <Card>
  <div class="flex w-full flex-col space-y-2 text-sm text-[color:var(--text-main)]">
    <div class="flex w-full gap-4">
      <div class="flex min-w-0 flex-1 flex-col space-y-1">
        <h2 class="text-base font-semibold tracking-[0.12em] uppercase break-words">
          {title}
        </h2>

        {description && (
          <p class="break-words text-[0.8rem] leading-relaxed text-[color:var(--text-muted)]">
            {description}
          </p>
        )}

        {contributors.length > 0 && (
          <p class="pt-1 text-[0.78rem] text-[color:var(--text-muted)]">
            <span class="font-semibold text-[color:var(--text-main)]">
              Contributors:
            </span>{' '}
            {contributors.join(', ')}
          </p>
        )}

        {languages.length > 0 && (
          <div class="flex w-full flex-wrap gap-2 pt-1 text-[0.75rem] text-[color:var(--text-muted)]">
            {languages.map((lang) => {
              const iconName = getLanguageIconName(lang);

              if (iconName) {
                return (
                  <span
                    class="inline-flex h-7 w-7 items-center justify-center rounded-full border border-slate-500/40 bg-slate-950/40"
                    aria-label={lang}
                    title={lang}
                  >
                    <Icon
                      name={iconName}
                      class="h-3.5 w-3.5 text-[color:var(--text-main)]"
                    />
                  </span>
                );
              }

              return (
                <span
                  class="inline-flex items-center rounded-full border border-slate-500/40 bg-slate-950/40 px-2 py-0.5"
                >
                  {lang}
                </span>
              );
            })}
          </div>
        )}
      </div>

      {(imageSrc || organisationSrc) && (
        <div class="flex items-start">
          <div class="flex flex-col items-center gap-2">
            {imageSrc && (
              <div class="h-16 w-16 shrink-0 overflow-hidden rounded-md border border-purple-400/40 bg-slate-900">
                <img
                  src={imageSrc}
                  alt={`${title} preview`}
                  loading="lazy"
                  class="h-full w-full object-cover"
                />
              </div>
            )}
            {organisationSrc && (
              <div class="h-8 w-8 shrink-0 overflow-hidden rounded-full border border-purple-400/40 bg-slate-900">
                <img
                  src={organisationSrc}
                  alt={`${title} organisation`}
                  loading="lazy"
                  class="h-full w-full object-cover"
                />
              </div>
            )}
          </div>
        </div>
      )}
    </div>

    {(links || demo) && (
      <div class="mt-1 flex w-full flex-col gap-2 pt-1 sm:flex-row">
        {links && (
          <a
            href={links}
            target="_blank"
            rel="noopener noreferrer"
            class="flex-1 min-w-0"
          >
            <Button class="w-full border-black text-[color:var(--text-main)] hover:border-black hover:bg-black/10">
              <span class="flex items-center justify-center gap-2">
                <Icon name="logos:github-icon" class="h-3.5 w-3.5" />
                <span>GitHub</span>
              </span>
            </Button>
          </a>
        )}

        {demo && (
          <a
            href={demo}
            target="_blank"
            rel="noopener noreferrer"
            class="flex-1 min-w-0"
          >
            <Button class="w-full border-sky-400 text-sky-100 hover:border-sky-300 hover:bg-sky-500/15">
              <span class="flex items-center justify-center gap-2">
                <Icon name="external-link" class="h-3.5 w-3.5" />
                <span>Demo</span>
              </span>
            </Button>
          </a>
        )}
      </div>
    )}
  </div>
  </Card>
</div>

<style>
  .project-card-animate {
    animation: project-card-enter 0.4s ease-out forwards;
  }

  @keyframes project-card-enter {
    from {
      opacity: 0;
      transform: translateY(0.75rem);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
